/*! Stapes UI - v0.1.0 - 2015-04-22
* Copyright (c) 2015 Marco Solazzi; Licensed MIT */
/**
 * Stapes Ui
 *
 * @projectDescription  Stapes.js Widget Framework
 * @author              Marco Solazzi
 * @license             MIT
 */
!function(t,e){"function"==typeof define&&define.amd?define(["stapes"],e):"object"==typeof exports?module.exports=e(require("stapes")):t.Stapes.Ui=e(t.Stapes)}(this,function(t){Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),n=this,i=function(){},o=function(){return n.apply(this instanceof i&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,o.prototype=new i,o});var e={},n=!0,i=t._,o=function(){},s="undefined"!=typeof console&&console.log?Function.prototype.bind.call(console.log,console):o;i.isPlainObject=function(t){return"object"!==i.typeOf(t)||t.nodeType||null!=t&&t===t.window?!1:t.constructor&&!t.constructor.prototype.hasOwnProperty("isPrototypeOf")?!1:!0},i.forOwn=function(t,e){var n;if(i.isPlainObject(t))for(n in t)t.hasOwnProperty(n)&&e.call(t,n,t[n])},i.each=function(t,e){for(var n=0,i=t.length;i>n;n++)e(t[n],n)},e.uid=0,e.Config={DEBUG:!1,VERBOSE:!1},e.vent=t.mixinEvents(),e.log=function(){s.apply(console,arguments)},e.init=function(o){i.extend(e.Config,o||{}),e.Config.DEBUG&&(t.on("all",function(t,n){e.log("stapes-ui: "+n.type,t||null,n)}),n=!e.Config.VERBOSE),e.vent.emit("bootstrap",e.Config)},e.addInitializer=function(t,n){var o;o="function"===i.typeOf(t)?t:function(i){var o=e.$(t);o&&o.length>0&&n.call(null,i,t,o)},e.vent.on("bootstrap",o)};var r=Array.prototype;e.Dom=function(t,n){var o,s=n||document;return this instanceof e.Dom?(null!==t&&void 0!==t?"string"==typeof t?o=Array.prototype.slice.call(s.querySelectorAll(t)):Array.isArray(t)?o=t:t.length?o=Array.prototype.slice.call(t):(1===t.nodeType||9===t.nodeType)&&(o=[t]):o=[],this.length=o.length,i.extend(this,o),this):new e.Dom(t,s)},e.Dom.parseJSON=function(t){return JSON.parse(t+"")},i.extend(e.Dom.prototype,{constructor:e.Dom,each:function(t){return r.every.call(this,function(e,n){return t.call(e,n,e)!==!1}),this},get:function(t){return null!==t&&void 0!==t?0>t?this[t+this.length]:this[t]:r.slice.call(this)},filter:function(t){var n=r.filter.call(this,function(e,n){return t.call(e,n,e)});return e.Dom(n)},text:function(t){return void 0===t?this.length>0?this[0].textContent:"":this.each(function(e,n){(1===n.nodeType||11===n.nodeType||9===n.nodeType)&&(n.textContent=t)})},html:function(t){return void 0!==t?this.length>0?this[0].innerHTML:"":this.each(function(e,n){n.innerHTML=t})}}),e.$=e.Dom;var a=/([a-z]+)\s?:/gi,c=/\'/g,l=/([A-Z])/g,u=/\-+/;e.Sandbox=t.subclass({constructor:function(){return arguments.length>0&&this.register.apply(this,arguments),this.id="sui-sbox-"+ ++t.Ui.uid,this.$root=null,this.root=null,this},_parseConfig:function(t,n,o){var s,r=n.prototype,u={};return r.hasOwnProperty("_options")&&i.isPlainObject(r._options)&&i.forOwn(r._options,function(e){var n=t+e.charAt(0).toUpperCase()+e.substr(1),i="data-"+n.replace(l,function(t){return"-"+t.toLowerCase()}),s=o.getAttribute(i);o.getAttribute(i)&&(u[e]=s)}),s=o.getAttribute("data-"+t+"-data")||{},"string"===i.typeOf(s)&&(s=s.replace(a,'"$1":').replace(c,'"'),s=e.$.parseJSON(s)||{}),u.data=s,u},_registerModule:function(t,e){var o=t.replace(u,""),s={active:!1};if("function"===i.typeOf(e))i.extend(s,{selector:'[data-sui-module="'+t+'"]',callback:e});else{if(!i.isPlainObject(e))throw new Error("Widget constructor not provided");i.extend(s,e)}s._instances=[],this.set(o,s,n)},_updateModule:function(t,e){this.set(t,e,n),this.emit("sandbox:update:"+t,e),this.emit("sandbox:update",e)},register:function(t,e){return i.isPlainObject(t)?i.forOwn(t,this._registerModule.bind(this)):this._registerModule(t,e),this},start:function(t){var n,i=this;this.$root=e.$(t||document),n=this.root=this.$root[0],this.stop(),this.each(function(t,o){var s=t._instances;t.active!==!0&&t.selector&&(e.$(t.selector,n).filter(function(t,e){return!(e.hasAttribute("data-sui-skip")||e.hasAttribute("data-sui-active"))}).each(function(e,n){var r,a=i._parseConfig(o,t.callback,n);a.el=n,r=new t.callback(a,i).render(),n.setAttribute("data-sui-active","true"),s.push(r)}),t.active=!0,this._updateModule(o,t))}),this.emit("sandbox:start",this)},stop:function(){var t=!1;this.each(function(e,n){var o;if(e.active){for(t=!0;e._instances.length;)o=e._instances.pop(),o.el.removeAttribute("data-sui-active"),"function"===i.typeOf(o.destroy)&&o.destroy.call(o);e.active=!1,this._updateModule(n,e)}}),t&&this.emit("sandbox:stop",this)}}),e.Sandbox.legacySelector=!1;var h=["$el","el","tagName","className"];e.Module=t.subclass({_options:{replace:!1},_data:{},tagName:"div",className:"",_configureProperty:function(t){this.options.hasOwnProperty(t)&&(this[t]=this.options[t])},_replaceEl:function(){var t=document.createElement(this.tagName),n=this.el,i=n.parentNode;t.className=this.className||"",i.replaceChild(t,n),this.el=t,this.$el=e.$(t)},_createEl:function(){var t=document.createElement(this.tagName);t.className=this.className||"",this.el=t,this.$el=e.$(t)},constructor:function(t,o){return this.options=i.extend({},this._options,t||{}),i.each(h,this._configureProperty.bind(this)),this.set(i.extend({},this._data,this.options.data||{}),n),this.el?(this.$el=e.$(this.el),this.el=this.$el[0]):this.$el?(this.$el=this.$el instanceof e.$?this.$el:e.$(this.$el),this.el=this.$el[0]):this._createEl(),this.options.replace===!0&&this._replaceEl(),o&&o instanceof e.Sandbox&&(this.broadcast=o.emit.bind(o),this.onBroadcast=o.on.bind(o),this.offBroadcast=o.off.bind(o)),this.initialize.apply(this,arguments),this},initialize:o,render:function(){return this},destroy:o,broadcast:o,onBroadcast:o,offBroadcast:o});var p=e.Module.subclass;return e.Module.subclass=function(t,n){return t&&!t.hasOwnProperty("constructor")&&(t.constructor=e.Module.prototype.constructor),p.call(this,t,n)},e});