/*! Stapes UI - v0.0.3 - 2015-01-05
* Copyright (c) 2015 Marco Solazzi; Licensed MIT */
/**
 * Stapes Ui
 *
 * @projectDescription  Stapes.js Widget FrameworkEJF is a single namespaced, module pattern oriented functions collection for frontend development.
 * @author              Marco Solazzi
 * @license             MIT
 */
!function(a,b){"function"==typeof define&&define.amd?define(["stapes","jquery"],b):"object"==typeof exports?module.exports=b(require("stapes"),require("jquery")):a.Stapes.Ui=b(a.Stapes,a.jQuery)}(this,function(a,b){Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e});var c={},d=!0,e=a._,f=function(){},g="undefined"!=typeof console&&console.log?Function.prototype.bind.call(console.log,console):f;e.isPlainObject=function(a){return"object"!==e.typeOf(a)||a.nodeType||null!=a&&a===a.window?!1:a.constructor&&!a.constructor.prototype.hasOwnProperty("isPrototypeOf")?!1:!0},e.forOwn=function(a,b){var c;if(e.isPlainObject(a))for(c in a)a.hasOwnProperty(c)&&b.call(a,c,a[c])},e.each=function(a,b){for(var c=0,d=a.length;d>c;c++)b(a[c],c)},c.uid=0,c.Config={DEBUG:!1,VERBOSE:!1},c.vent=a.mixinEvents(),c.log=function(){g.apply(console,arguments)},c.init=function(b){e.extend(c.Config,b||{}),c.Config.DEBUG&&(a.on("all",function(a,b){c.log("stapes-ui: "+b.type,a||null,b)}),d=!c.Config.VERBOSE),c.vent.emit("bootstrap",c.Config)},c.addInitializer=function(a,d){var f;f="function"===e.typeOf(a)?a:function(c){var e=b(a);e&&e.length>0&&d.call(null,c,a,e)},c.vent.on("bootstrap",f)};var h=/([a-z]+)\s?:/gi,i=/\'/g,j=/\-+/;c.Sandbox=a.subclass({constructor:function(){return arguments.length>0&&this.register.apply(this,arguments),this.id="sui-sbox-"+ ++a.Ui.uid,this.$root=null,this},_parseConfig:function(a,c,d){var f,g,j=c.prototype,k=d.data("sui-"+a+"-conf")||{};return"string"===e.typeOf(k)&&(k=k.replace(h,'"$1":').replace(i,'"'),k=b.parseJSON(k)||{}),j.hasOwnProperty("_options")&&e.isPlainObject(j._options)&&(f=d.data(),e.forOwn(j._options,function(b){var c=a+b.charAt(0).toUpperCase()+b.substr(1);f.hasOwnProperty(c)&&(k[b]=f[c])})),g=d.data(a+"-data")||{},"string"===e.typeOf(g)&&(g=g.replace(h,'"$1":').replace(i,'"'),g=b.parseJSON(g)||{}),k.data||(k.data=g),k},_registerModule:function(a,b){var c=a.replace(j,""),f={active:!1};if("function"===e.typeOf(b))e.extend(f,{selector:'[data-sui-module="'+a+'"]',callback:b});else{if(!e.isPlainObject(b))throw new Error("Widget constructor not provided");e.extend(f,b)}f._instances=[],this.set(c,f,d)},_updateModule:function(a,b){this.set(a,b,d),this.emit("sandbox:update:"+a,b),this.emit("sandbox:update",b)},register:function(a,b){return e.isPlainObject(a)?e.forOwn(a,this._registerModule.bind(this)):this._registerModule(a,b),this},start:function(a){var c,d=this;c=this.$root=b(a||document),this.stop(),this.each(function(a,f){var g,h,i=a._instances;a.active!==!0&&a.selector&&(g=c.find(a.selector),g&&g.length>0&&(h=g.not("[data-sui-skip],[data-sui-active]").get(),e.each(h,function(c){var e,g=b(c),h=d._parseConfig(f,a.callback,g);h.$el=g,e=new a.callback(h,d).render(),g.data("sui-"+f,e).attr("data-sui-active",!0),i.push(e)})),a.active=!0,this._updateModule(f,a))}),this.emit("sandbox:start",this)},stop:function(){var a=!1;this.each(function(b,c){var d;if(b.active){for(a=!0;b._instances.length;)d=b._instances.pop(),"function"===e.typeOf(d.destroy)&&d.destroy.call(d);b.active=!1,this._updateModule(c,b)}}),a&&this.emit("sandbox:stop",this)}}),c.Sandbox.legacySelector=!1;var k=["$el","tagName","className"];c.Module=a.subclass({_options:{replace:!1},_data:{},tagName:"div",_configureProperty:function(a){this.options.hasOwnProperty(a)&&(this[a]=this.options[a])},_replaceEl:function(){var a=b(document.createElement(this.tagName)).addClass(this.className||"");this.$el.replaceWith(a),this.$el=a},constructor:function(a,b){return this.options=e.extend({},this._options,a||{}),e.each(k,this._configureProperty.bind(this)),this.set(e.extend({},this._data,this.options.data||{}),d),this.options.replace===!0&&this._replaceEl(),b&&b instanceof c.Sandbox&&(this.broadcast=b.emit.bind(b),this.onBroadcast=b.on.bind(b),this.offBroadcast=b.off.bind(b)),this.initialize.apply(this,arguments),this},initialize:f,render:function(){return this},destroy:f,broadcast:f,onBroadcast:f,offBroadcast:f});var l=c.Module.subclass;return c.Module.subclass=function(a,b){return a&&!a.hasOwnProperty("constructor")&&(a.constructor=c.Module.prototype.constructor),l.call(this,a,b)},c});