/*! Stapes UI - v0.0.3 - 2015-03-13
* Copyright (c) 2015 Marco Solazzi; Licensed MIT */
/**
 * Stapes Ui
 *
 * @projectDescription  Stapes.js Widget FrameworkEJF is a single namespaced, module pattern oriented functions collection for frontend development.
 * @author              Marco Solazzi
 * @license             MIT
 */
!function(t,e){"function"==typeof define&&define.amd?define(["stapes","jquery"],e):"object"==typeof exports?module.exports=e(require("stapes"),require.resolve("jquery")?require("jquery"):{}):t.Stapes.Ui=e(t.Stapes,t.jQuery||t.Zepto||t.ender||t.$)}(this,function(t,e){Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),n=this,o=function(){},i=function(){return n.apply(this instanceof o&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return o.prototype=this.prototype,i.prototype=new o,i});var n={},o=!0,i=t._,s=function(){},r="undefined"!=typeof console&&console.log?Function.prototype.bind.call(console.log,console):s;i.isPlainObject=function(t){return"object"!==i.typeOf(t)||t.nodeType||null!=t&&t===t.window?!1:t.constructor&&!t.constructor.prototype.hasOwnProperty("isPrototypeOf")?!1:!0},i.forOwn=function(t,e){var n;if(i.isPlainObject(t))for(n in t)t.hasOwnProperty(n)&&e.call(t,n,t[n])},i.each=function(t,e){for(var n=0,o=t.length;o>n;n++)e(t[n],n)},n.$=e,n.uid=0,n.Config={DEBUG:!1,VERBOSE:!1},n.vent=t.mixinEvents(),n.log=function(){r.apply(console,arguments)},n.init=function(e){i.extend(n.Config,e||{}),n.Config.DEBUG&&(t.on("all",function(t,e){n.log("stapes-ui: "+e.type,t||null,e)}),o=!n.Config.VERBOSE),n.vent.emit("bootstrap",n.Config)},n.addInitializer=function(t,e){var o;o="function"===i.typeOf(t)?t:function(o){var i=n.$(t);i&&i.length>0&&e.call(null,o,t,i)},n.vent.on("bootstrap",o)};var a=/([a-z]+)\s?:/gi,c=/\'/g,u=/\-+/;n.Sandbox=t.subclass({constructor:function(){return arguments.length>0&&this.register.apply(this,arguments),this.id="sui-sbox-"+ ++t.Ui.uid,this.$root=null,this},_parseConfig:function(t,e,o){var s,r,u=e.prototype,l=o.data("sui-"+t+"-conf")||{};return"string"===i.typeOf(l)&&(l=l.replace(a,'"$1":').replace(c,'"'),l=n.$.parseJSON(l)||{}),u.hasOwnProperty("_options")&&i.isPlainObject(u._options)&&(s=o.data(),i.forOwn(u._options,function(e){var n=t+e.charAt(0).toUpperCase()+e.substr(1);s.hasOwnProperty(n)&&(l[e]=s[n])})),r=o.data(t+"-data")||{},"string"===i.typeOf(r)&&(r=r.replace(a,'"$1":').replace(c,'"'),r=n.$.parseJSON(r)||{}),l.data||(l.data=r),l},_registerModule:function(t,e){var n=t.replace(u,""),s={active:!1};if("function"===i.typeOf(e))i.extend(s,{selector:'[data-sui-module="'+t+'"]',callback:e});else{if(!i.isPlainObject(e))throw new Error("Widget constructor not provided");i.extend(s,e)}s._instances=[],this.set(n,s,o)},_updateModule:function(t,e){this.set(t,e,o),this.emit("sandbox:update:"+t,e),this.emit("sandbox:update",e)},register:function(t,e){return i.isPlainObject(t)?i.forOwn(t,this._registerModule.bind(this)):this._registerModule(t,e),this},start:function(t){var e,o=this;e=this.$root=n.$(t||document),this.stop(),this.each(function(t,s){var r,a,c=t._instances;t.active!==!0&&t.selector&&(r=e.find(t.selector),r&&r.length>0&&(a=r.not("[data-sui-skip],[data-sui-active]").get(),i.each(a,function(e){var i,r=n.$(e),a=o._parseConfig(s,t.callback,r);a.$el=r,i=new t.callback(a,o).render(),r.data("sui-"+s,i).attr("data-sui-active",!0),c.push(i)})),t.active=!0,this._updateModule(s,t))}),this.emit("sandbox:start",this)},stop:function(){var t=!1;this.each(function(e,n){var o;if(e.active){for(t=!0;e._instances.length;)o=e._instances.pop(),"function"===i.typeOf(o.destroy)&&o.destroy.call(o);e.active=!1,this._updateModule(n,e)}}),t&&this.emit("sandbox:stop",this)}}),n.Sandbox.legacySelector=!1;var l=["$el","tagName","className"];n.Module=t.subclass({_options:{replace:!1},_data:{},tagName:"div",_configureProperty:function(t){this.options.hasOwnProperty(t)&&(this[t]=this.options[t])},_replaceEl:function(){var t=n.$(document.createElement(this.tagName)).addClass(this.className||"");this.$el.replaceWith(t),this.$el=t},constructor:function(t,e){return this.options=i.extend({},this._options,t||{}),i.each(l,this._configureProperty.bind(this)),this.set(i.extend({},this._data,this.options.data||{}),o),this.options.replace===!0&&this._replaceEl(),e&&e instanceof n.Sandbox&&(this.broadcast=e.emit.bind(e),this.onBroadcast=e.on.bind(e),this.offBroadcast=e.off.bind(e)),this.initialize.apply(this,arguments),this},initialize:s,render:function(){return this},destroy:s,broadcast:s,onBroadcast:s,offBroadcast:s});var p=n.Module.subclass;return n.Module.subclass=function(t,e){return t&&!t.hasOwnProperty("constructor")&&(t.constructor=n.Module.prototype.constructor),p.call(this,t,e)},n});