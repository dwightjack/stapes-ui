/*! Stapes UI - v0.1.0 - 2015-04-22
* Copyright (c) 2015 Marco Solazzi; Licensed MIT */
/**
 * Stapes Ui
 *
 * @projectDescription  Stapes.js Widget FrameworkEJF is a single namespaced, module pattern oriented functions collection for frontend development.
 * @author              Marco Solazzi
 * @license             MIT
 */
!function(t,e){"function"==typeof define&&define.amd?define(["stapes","jquery"],e):"object"==typeof exports?module.exports=e(require("stapes"),require("jquery")||{}):t.Stapes.Ui=e(t.Stapes,t.jQuery||t.Zepto||t.ender||t.$)}(this,function(t,e){Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),n=this,i=function(){},o=function(){return n.apply(this instanceof i&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,o.prototype=new i,o});var n={},i=!0,o=t._,r=function(){},s="undefined"!=typeof console&&console.log?Function.prototype.bind.call(console.log,console):r;o.isPlainObject=function(t){return"object"!==o.typeOf(t)||t.nodeType||null!=t&&t===t.window?!1:t.constructor&&!t.constructor.prototype.hasOwnProperty("isPrototypeOf")?!1:!0},o.forOwn=function(t,e){var n;if(o.isPlainObject(t))for(n in t)t.hasOwnProperty(n)&&e.call(t,n,t[n])},o.each=function(t,e){for(var n=0,i=t.length;i>n;n++)e(t[n],n)},n.$=e,n.uid=0,n.Config={DEBUG:!1,VERBOSE:!1},n.vent=t.mixinEvents(),n.log=function(){s.apply(console,arguments)},n.init=function(e){o.extend(n.Config,e||{}),n.Config.DEBUG&&(t.on("all",function(t,e){n.log("stapes-ui: "+e.type,t||null,e)}),i=!n.Config.VERBOSE),n.vent.emit("bootstrap",n.Config)},n.addInitializer=function(t,e){var i;i="function"===o.typeOf(t)?t:function(i){var o=n.$(t);o&&o.length>0&&e.call(null,i,t,o)},n.vent.on("bootstrap",i)};var a=Array.prototype;n.Dom=function(t,e){var i,r=e||document;return this instanceof n.Dom?(null!==t&&void 0!==t?"string"==typeof t?i=Array.prototype.slice.call(r.querySelectorAll(t)):Array.isArray(t)?i=t:t.length?i=Array.prototype.slice.call(t):(1===t.nodeType||9===t.nodeType)&&(i=[t]):i=[],this.length=i.length,o.extend(this,i),this):new n.Dom(t,r)},n.Dom.parseJSON=function(t){return JSON.parse(t+"")},o.extend(n.Dom.prototype,{constructor:n.Dom,each:function(t){return a.every.call(this,function(e,n){return t.call(e,n,e)!==!1}),this},get:function(t){return null!==t&&void 0!==t?0>t?this[t+this.length]:this[t]:a.slice.call(this)},filter:function(t){var e=a.filter.call(this,function(e,n){return t.call(e,n,e)});return n.Dom(e)},text:function(t){return void 0===t?this.length>0?this[0].textContent:"":this.each(function(e,n){(1===n.nodeType||11===n.nodeType||9===n.nodeType)&&(n.textContent=t)})},html:function(t){return void 0!==t?this.length>0?this[0].innerHTML:"":this.each(function(e,n){n.innerHTML=t})}}),n.$=n.Dom;var c=/([a-z]+)\s?:/gi,l=/\'/g,u=/([A-Z])/g,h=/\-+/;n.Sandbox=t.subclass({constructor:function(){return arguments.length>0&&this.register.apply(this,arguments),this.id="sui-sbox-"+ ++t.Ui.uid,this.$root=null,this},_parseConfig:function(t,e,i){var r,s=e.prototype,a={};return s.hasOwnProperty("_options")&&o.isPlainObject(s._options)&&o.forOwn(s._options,function(e){var n=t+e.charAt(0).toUpperCase()+e.substr(1),o="data-"+n.replace(u,function(t){return"-"+t.toLowerCase()}),r=i.getAttribute(o);i.getAttribute(o)&&(a[e]=r)}),r=i.getAttribute("data-"+t+"-data")||{},"string"===o.typeOf(r)&&(r=r.replace(c,'"$1":').replace(l,'"'),r=n.$.parseJSON(r)||{}),a.data=r,a},_registerModule:function(t,e){var n=t.replace(h,""),r={active:!1};if("function"===o.typeOf(e))o.extend(r,{selector:'[data-sui-module="'+t+'"]',callback:e});else{if(!o.isPlainObject(e))throw new Error("Widget constructor not provided");o.extend(r,e)}r._instances=[],this.set(n,r,i)},_updateModule:function(t,e){this.set(t,e,i),this.emit("sandbox:update:"+t,e),this.emit("sandbox:update",e)},register:function(t,e){return o.isPlainObject(t)?o.forOwn(t,this._registerModule.bind(this)):this._registerModule(t,e),this},start:function(t){var e,i=this;this.$root=n.$(t||document),e=this.root=this.$root[0],this.stop(),this.each(function(t,o){var r=t._instances;t.active!==!0&&t.selector&&(n.$(t.selector,e).filter(function(t,e){return!(e.hasAttribute("data-sui-skip")||e.hasAttribute("data-sui-active"))}).each(function(e,n){var s,a=i._parseConfig(o,t.callback,n);a.el=n,s=new t.callback(a,i).render(),n.setAttribute("data-sui-active","true"),r.push(s)}),t.active=!0,this._updateModule(o,t))}),this.emit("sandbox:start",this)},stop:function(){var t=!1;this.each(function(e,n){var i;if(e.active){for(t=!0;e._instances.length;)i=e._instances.pop(),i.el.removeAttribute("data-sui-active"),"function"===o.typeOf(i.destroy)&&i.destroy.call(i);e.active=!1,this._updateModule(n,e)}}),t&&this.emit("sandbox:stop",this)}}),n.Sandbox.legacySelector=!1;var p=["$el","el","tagName","className"];n.Module=t.subclass({_options:{replace:!1},_data:{},tagName:"div",_configureProperty:function(t){this.options.hasOwnProperty(t)&&(this[t]=this.options[t])},_replaceEl:function(){var t=document.createElement(this.tagName),e=this.el,i=e.parentNode;t.className=this.className||"",i.replaceChild(t,e),this.el=t,this.$el=n.$(t)},_createEl:function(){var t=document.createElement(this.tagName);t.className=this.className||"",this.el=t,this.$el=n.$(t)},constructor:function(t,e){return this.options=o.extend({},this._options,t||{}),o.each(p,this._configureProperty.bind(this)),this.set(o.extend({},this._data,this.options.data||{}),i),this.el?this.$el=n.$(this.el):this.$el?(this.$el=this.$el instanceof n.$?this.$el:n.$(this.$el),this.el=this.$el[0]):this._createEl(),this.options.replace===!0&&this._replaceEl(),e&&e instanceof n.Sandbox&&(this.broadcast=e.emit.bind(e),this.onBroadcast=e.on.bind(e),this.offBroadcast=e.off.bind(e)),this.initialize.apply(this,arguments),this},initialize:r,render:function(){return this},destroy:r,broadcast:r,onBroadcast:r,offBroadcast:r});var d=n.Module.subclass;return n.Module.subclass=function(t,e){return t&&!t.hasOwnProperty("constructor")&&(t.constructor=n.Module.prototype.constructor),d.call(this,t,e)},n});